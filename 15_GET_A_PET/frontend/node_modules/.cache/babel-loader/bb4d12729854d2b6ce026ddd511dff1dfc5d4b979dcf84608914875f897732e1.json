{"ast":null,"code":"var _s = $RefreshSig$();\nimport api from \"../utils/api\";\nimport { userState, userEffect, useState, useEffect } from \"react\";\nimport { useHistory } from \"react-router-dom\";\nimport useFlashMessage from \"./useFlashMessage\";\nexport default function useAuth() {\n  _s();\n  const [authenticated, setAuthenticated] = useState(false);\n  const {\n    setFlashMessage\n  } = useFlashMessage();\n  const history = useHistory();\n  useEffect(() => {\n    const token = localStorage.getItem('token');\n    if (token) {\n      api.defaults.headers.Authorization = `Bearer ${JSON.parse(token)}`;\n      setAuthenticated(true);\n    }\n  }, []);\n  async function register(user) {\n    let msgText = 'Cadastro realizado com sucesso!';\n    let msgType = 'sucess';\n    try {\n      const data = await api.post(\"/users/register\", user).then(response => {\n        return response.data;\n      });\n      await authUser(data);\n    } catch (error) {\n      msgText = error.response.data.message;\n      msgType = 'error';\n    }\n    setFlashMessage(msgText, msgType);\n  }\n  async function authUser(data) {\n    setAuthenticated(true);\n    localStorage.setItem('token', JSON.stringify(data.token));\n    history.push('/');\n  }\n  function logout() {\n    const msgText = 'Logout realizado com sucesso!';\n    const msgType = 'sucess';\n    setAuthenticated(false);\n    localStorage.removeItem('token');\n    api.defaults.headers.Authorization = undefined;\n    history.push('/');\n    setFlashMessage(msgText, msgType);\n  }\n  return {\n    authenticated,\n    register\n  };\n}\n_s(useAuth, \"wVPDpElFmvJHQhhU5x/ZMREcZwg=\", false, function () {\n  return [useFlashMessage, useHistory];\n});","map":{"version":3,"names":["api","userState","userEffect","useState","useEffect","useHistory","useFlashMessage","useAuth","_s","authenticated","setAuthenticated","setFlashMessage","history","token","localStorage","getItem","defaults","headers","Authorization","JSON","parse","register","user","msgText","msgType","data","post","then","response","authUser","error","message","setItem","stringify","push","logout","removeItem","undefined"],"sources":["C:/Users/rosi_/OneDrive/Ãrea de Trabalho/Curso-node.js-com-Matheus/15_GET_A_PET/frontend/src/hooks/useAuth.js"],"sourcesContent":["import api from \"../utils/api\"\r\n\r\nimport {userState, userEffect, useState, useEffect} from \"react\"\r\nimport {useHistory} from \"react-router-dom\"\r\nimport useFlashMessage from \"./useFlashMessage\"\r\n\r\nexport default function useAuth(){\r\n    const [authenticated, setAuthenticated] = useState(false)\r\n    const { setFlashMessage } = useFlashMessage()\r\n    const history = useHistory()\r\n\r\n    useEffect(() => {\r\n        const token = localStorage.getItem('token')\r\n\r\n        if(token){\r\n            api.defaults.headers.Authorization = `Bearer ${JSON.parse(token)}`\r\n            setAuthenticated(true)\r\n        }\r\n    }, [])\r\n\r\n    async function register(user){\r\n\r\n        let msgText = 'Cadastro realizado com sucesso!'\r\n        let msgType = 'sucess'\r\n\r\n        try{\r\n            const data = await api.post(\"/users/register\", user).then((response) => {\r\n                return response.data\r\n            })\r\n\r\n            await authUser(data)\r\n        }catch(error){\r\n            msgText = error.response.data.message\r\n            msgType = 'error'\r\n        }\r\n\r\n        setFlashMessage(msgText, msgType)\r\n    }\r\n\r\n    async function authUser(data){\r\n\r\n        setAuthenticated(true)\r\n\r\n        localStorage.setItem('token', JSON.stringify(data.token))\r\n\r\n        history.push('/')\r\n\r\n    }\r\n\r\n    function logout(){\r\n        const msgText = 'Logout realizado com sucesso!'\r\n        const msgType = 'sucess'\r\n\r\n        setAuthenticated(false)\r\n        localStorage.removeItem('token')\r\n        api.defaults.headers.Authorization = undefined\r\n        history.push('/')\r\n\r\n        setFlashMessage( msgText, msgType )\r\n    }\r\n    return { authenticated, register }\r\n}"],"mappings":";AAAA,OAAOA,GAAG,MAAM,cAAc;AAE9B,SAAQC,SAAS,EAAEC,UAAU,EAAEC,QAAQ,EAAEC,SAAS,QAAO,OAAO;AAChE,SAAQC,UAAU,QAAO,kBAAkB;AAC3C,OAAOC,eAAe,MAAM,mBAAmB;AAE/C,eAAe,SAASC,OAAOA,CAAA,EAAE;EAAAC,EAAA;EAC7B,MAAM,CAACC,aAAa,EAAEC,gBAAgB,CAAC,GAAGP,QAAQ,CAAC,KAAK,CAAC;EACzD,MAAM;IAAEQ;EAAgB,CAAC,GAAGL,eAAe,CAAC,CAAC;EAC7C,MAAMM,OAAO,GAAGP,UAAU,CAAC,CAAC;EAE5BD,SAAS,CAAC,MAAM;IACZ,MAAMS,KAAK,GAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC;IAE3C,IAAGF,KAAK,EAAC;MACLb,GAAG,CAACgB,QAAQ,CAACC,OAAO,CAACC,aAAa,GAAG,UAAUC,IAAI,CAACC,KAAK,CAACP,KAAK,CAAC,EAAE;MAClEH,gBAAgB,CAAC,IAAI,CAAC;IAC1B;EACJ,CAAC,EAAE,EAAE,CAAC;EAEN,eAAeW,QAAQA,CAACC,IAAI,EAAC;IAEzB,IAAIC,OAAO,GAAG,iCAAiC;IAC/C,IAAIC,OAAO,GAAG,QAAQ;IAEtB,IAAG;MACC,MAAMC,IAAI,GAAG,MAAMzB,GAAG,CAAC0B,IAAI,CAAC,iBAAiB,EAAEJ,IAAI,CAAC,CAACK,IAAI,CAAEC,QAAQ,IAAK;QACpE,OAAOA,QAAQ,CAACH,IAAI;MACxB,CAAC,CAAC;MAEF,MAAMI,QAAQ,CAACJ,IAAI,CAAC;IACxB,CAAC,QAAMK,KAAK,EAAC;MACTP,OAAO,GAAGO,KAAK,CAACF,QAAQ,CAACH,IAAI,CAACM,OAAO;MACrCP,OAAO,GAAG,OAAO;IACrB;IAEAb,eAAe,CAACY,OAAO,EAAEC,OAAO,CAAC;EACrC;EAEA,eAAeK,QAAQA,CAACJ,IAAI,EAAC;IAEzBf,gBAAgB,CAAC,IAAI,CAAC;IAEtBI,YAAY,CAACkB,OAAO,CAAC,OAAO,EAAEb,IAAI,CAACc,SAAS,CAACR,IAAI,CAACZ,KAAK,CAAC,CAAC;IAEzDD,OAAO,CAACsB,IAAI,CAAC,GAAG,CAAC;EAErB;EAEA,SAASC,MAAMA,CAAA,EAAE;IACb,MAAMZ,OAAO,GAAG,+BAA+B;IAC/C,MAAMC,OAAO,GAAG,QAAQ;IAExBd,gBAAgB,CAAC,KAAK,CAAC;IACvBI,YAAY,CAACsB,UAAU,CAAC,OAAO,CAAC;IAChCpC,GAAG,CAACgB,QAAQ,CAACC,OAAO,CAACC,aAAa,GAAGmB,SAAS;IAC9CzB,OAAO,CAACsB,IAAI,CAAC,GAAG,CAAC;IAEjBvB,eAAe,CAAEY,OAAO,EAAEC,OAAQ,CAAC;EACvC;EACA,OAAO;IAAEf,aAAa;IAAEY;EAAS,CAAC;AACtC;AAACb,EAAA,CAvDuBD,OAAO;EAAA,QAECD,eAAe,EAC3BD,UAAU;AAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}